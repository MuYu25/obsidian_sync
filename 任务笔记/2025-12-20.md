# 实际毛利
需要返回所有应用的本日毛利和返回所有应用的本月毛利。
if 实际广告收入 > 0:
	实际毛利 = 实际广告收入＋第三方平台结算金额-提现到账金额 - 推广消耗
else:
	0
- 实际广告收入和推广消耗
```go
for d := startTime; !d.After(endTime); d = d.AddDate(0, 0, 1) {
	var adIncome *entity.StatDailyAdIncome
	dao.StatDailyAdIncome.Ctx(ctx).
		Where(dao.StatDailyAdIncome.Columns().Date, day).
		Where(dao.StatDailyAdIncome.Columns().AppId, appId).
		Scan(&adIncome)
	adIncome.AdvertActualIncome // 实际广告收入
	adIncome.PromotionUseAmount // 推广消耗
}
```
- 提现到账金额
```go
type resultStruct struct {
	Date   string `json:"date"`
	Amount int64  `json:"amount"`
}
var arrivalResult []resultStruct
dao.WithdrawalOrder.Ctx(ctx).
	Fields("DATE(transfer_time) as date", "sum(amount) as amount").
	WhereBetween("DATE(transfer_time)", startTime.Format(time.DateOnly), endTime.Format(time.DateOnly)).
	Where(dao.WithdrawalOrder.Columns().OrderState, 2).
	Where(dao.WithdrawalOrder.Columns().AppId, appId).
	Group("date").
	Order("date").
	Scan(&arrivalResult)
```
- 第三方平台结算金额
```go
var otherResult []resultStruct
// 三方平台收益（悬赏任务平台）
err = dao.RtOrder.Ctx(ctx).
	Fields("DATE_FORMAT(created_at,'%Y-%m') as date", "sum(amount) as amount").
	WhereBetween("DATE(created_at)", startTime.Format(time.DateOnly), endTime.Format(time.DateOnly)).
	Where(dao.RtOrder.Columns().AppId, appId).
	Group("DATE_FORMAT(created_at,'%Y-%m')").
	Scan(&otherResult)
```
# 活跃人数

clickhouse sql语句
```sql
select
	DATE(event_time) as day,
	COUNT(distinct device_id) as active_users
from
	account_event ae
where
	appi_id = ?
GROUP by
	DATE(event_time)
ORDER by
	day desc
```